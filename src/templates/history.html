{% extends "base.html" %}

{% block content %}
<div class="history-page">
    <h2>Prediction History</h2>
    <p>Good marks are correct calls, bad marks are missed calls.</p>

    {% if stats %}
    <div class="summary">
        <div class="card">
            <h3>Total Win Rate</h3>
            <p>{{ stats.win_rate }}%</p>
        </div>
        <div class="card">
            <h3>Last Prediction WR</h3>
            <p>{{ stats.last_prediction_wr }}%</p>
        </div>
        <div class="card">
            <h3>Total Wins</h3>
            <p>{{ stats.wins }}</p>
        </div>
        <div class="card">
            <h3>Total Losses</h3>
            <p>{{ stats.losses }}</p>
        </div>
        <div class="card">
            <h3>Total Pushes</h3>
            <p>{{ stats.pushes }}</p>
        </div>
    </div>
    {% endif %}

    {% if records %}
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Matchup</th>
                    <th>Status</th>
                    <th>Line</th>
                    <th>Predicted Total</th>
                    <th>AI Pick</th>
                    <th>Confidence %</th>
                    <th>Final Total</th>
                    <th>Final Result</th>
                    <th>Analysis</th>
                    <th>Outcome</th>
                </tr>
            </thead>
            <tbody>
                {% for row in records %}
                <tr class="{{ row.outcome_class }}">
                    <td>{{ row.date|wat_time }} WAT</td>
                        <td>{{ row.matchup }}</td>
                    <td>
                        {% if row.status == 'live' %}
                            <span class="badge live">LIVE</span>
                        {% else %}
                            <span class="badge final">FINAL</span>
                        {% endif %}
                    </td>
                    <td>{{ row.line }} pts</td>
                    <td>{{ row.predicted_total }} pts</td>
                    <td>{{ row.predicted_class }}</td>
                    <td>{{ row.confidence }}%</td>
                    <td>{{ row.total_score }} pts</td>
                    <td>{{ row.final_result }}</td>
                    <td style="font-size: 0.8em; max-width: 200px;">{{ row.explanation }}</td>
                    <td class="decision">
                        {{ row.mark }} {{ row.outcome }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
        <p>No graded predictions yet. Enter results once games finish.</p>
    {% endif %}
    
    {% if team_rows %}
    <h3>Team Accuracy</h3>
    <div class="table-responsive">
        <table>
            <thead>
                <tr>
                    <th>Team</th>
                    <th>Games</th>
                    <th>MAE</th>
                    <th>Bias</th>
                    <th>Last 20 MAE</th>
                    <th>Last 20 Bias</th>
                </tr>
            </thead>
            <tbody>
                {% for t in team_rows %}
                <tr>
                    <td>{{ t.team }}</td>
                    <td>{{ t.count }}</td>
                    <td>{{ t.mae }}</td>
                    <td>{{ t.bias }}</td>
                    <td>{{ t.last_mae }}</td>
                    <td>{{ t.last_bias }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>
{% endblock %}
